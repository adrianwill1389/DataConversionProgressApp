@model List<DataConversionProgressApp.Models.CourtProgressRecord>

@{
    ViewData["Title"] = "Court Progress";
}

<style>
    select.form-control {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: white;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='8'%3e%3cpolygon%20fill='%23666'%20points='0,0%207,8%2014,0'%3e%3c/polygon%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 12px;
        padding-right: 30px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    select.form-control:focus {
        outline: none;
        border-color: #66afe9;
        box-shadow: 0 0 5px rgba(102,175,233, .6);
    }
</style>

<form method="get" asp-action="Index" id="filterForm">

    <div class="form-group text-center mb-4">
        <h4 class="text-info">Select Court</h4>
    </div>

    <input type="hidden" name="month" value="@ViewBag.SelectedMonth" />
    <input type="hidden" name="year" value="@ViewBag.SelectedYear" />

    <div class="form-group row mb-3">
        <label class="col-sm-2 col-form-label text-white">Select Court Type:</label>
        <div class="col-sm-4">
            <select name="courtType" class="form-control" onchange="document.getElementById('filterForm').submit();">  
               <option value="Day" selected="@((string)ViewBag.CourtType == "Day")">Day Court</option>  
               <option value="Night" selected="@((string)ViewBag.CourtType == "Night")">Night Court</option>  
            </select>
        </div>
    </div>
</form>

<form method="get" asp-action="Index" id="dateForm">
    <input type="hidden" name="courtType" value="@ViewBag.CourtType" />

    <div class="form-group text-center mb-4">
        <h4 class="text-info">Select Dates</h4>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label text-white">Select Month:</label>
        <div class="col-sm-4">
            @{
                int selectedMonth = ViewBag.SelectedMonth ?? 0;
            }
            <select name="month" class="form-control" onchange="document.getElementById('dateForm').submit();">
                @for (int m = 1; m <= 12; m++)  
                {  
                   var monthName = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(m);  
                   bool isSelected = selectedMonth == m;  
                   <option value="@m" selected="@(isSelected ? "selected" : null)">@monthName</option>  
                }
            </select>
        </div>

        <label class="col-sm-2 col-form-label text-white">Year:</label>
        <div class="col-sm-4">
            <input name="year" type="number" class="form-control" value="@ViewBag.SelectedYear" onchange="document.getElementById('dateForm').submit();" />
        </div>
    </div>
</form>

<form method="post" asp-action="Save">
    <input type="hidden" name="courtType" value="@ViewBag.CourtType" />
    <input type="hidden" name="month" value="@ViewBag.SelectedMonth" />
    <input type="hidden" name="year" value="@ViewBag.SelectedYear" />

    @if (TempData["SaveMessage"] != null)
    {
        <div class="alert alert-success text-center">
            @TempData["SaveMessage"]
        </div>
    }

    <table class="table table-bordered table-dark">
        <thead>
            <tr>
                <th>Date</th>

                @if (ViewBag.CourtType == "Day")
                {
                    <th>Court 1 Disposed</th>
                    <th>Court 1 Warrant</th>
                    <th>Court 2 Disposed</th>
                    <th>Court 2 Warrant</th>
                }
                else if (ViewBag.CourtType == "Night")
                {
                    <th>Court 1</th>
                    <th>Court 2</th>
                    <th>Court 3</th>
                }

                <th>Progress</th>
                <th>Status</th>
            </tr>
        </thead>
                <tbody>
     @for (int i = 0; i < Model.Count; i++)
     {
         <tr>
             <td>
                 <input type="hidden" name="model[@i].DateReceived" value="@Model[i].DateReceived.ToString("yyyy-MM-dd")" />
                 @Model[i].DateReceived.ToString("dddd, MMM d, yyyy")
             </td>

             @if (ViewBag.CourtType == "Day")
             {
                        <td>
                            <input type="checkbox" name="model[@i].Court1Disposed" value="true" @(Model[i].Court1Disposed ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court1Disposed" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court1DisposedBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@Model[i].Court1DisposedBy.Trim()</strong>
                                </div>
                            }
                        </td>
                        <td>
                            <input type="checkbox" name="model[@i].Court1Warrant" value="true" @(Model[i].Court1Warrant ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court1Warrant" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court1WarrantBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@Model[i].Court1WarrantBy.Trim()</strong>
                                </div>
                            }
                        </td>
                        <td>
                            <input type="checkbox" name="model[@i].Court2Disposed" value="true" @(Model[i].Court2Disposed ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court2Disposed" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court2DisposedBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@Model[i].Court2DisposedBy.Trim()</strong>
                                </div>
                            }
                        </td>
                        <td>
                            <input type="checkbox" name="model[@i].Court2Warrant" value="true" @(Model[i].Court2Warrant ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court2Warrant" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court2WarrantBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@Model[i].Court2WarrantBy.Trim()</strong>
                                </div>
                            }
                        </td>


             }
             else if (ViewBag.CourtType == "Night")
             {
                        <td>
                            <input type="checkbox" name="model[@i].Court1Night" value="true" @(Model[i].Court1Night ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court1Night" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court1NightBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@(Model[i].Court1NightBy?.Trim() ?? "")</strong>
                                </div>
                            }
                        </td>

                        <td>
                            <input type="checkbox" name="model[@i].Court2Night" value="true" @(Model[i].Court2Night ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court2Night" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court2NightBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@(Model[i].Court2NightBy?.Trim() ?? "")</strong>
                                </div>
                            }
                        </td>

                        <td>
                            <input type="checkbox" name="model[@i].Court3Night" value="true" @(Model[i].Court3Night ? "checked" : "") />
                            <input type="hidden" name="model[@i].Court3Night" value="false" />
                            @if (!string.IsNullOrWhiteSpace(Model[i].Court3NightBy))
                            {
                                <div style="color: #0d6efd;" class="small"
                                     title="Last updated by @Model[i].UpdatedBy on @Model[i].LastUpdated.ToString("MMM d, yyyy h:mm tt")">
                                    ✓ <strong>@(Model[i].Court3NightBy?.Trim() ?? "")</strong>
                                </div>
                            }
                        </td>



             }

             <td>
                 @{
                     int totalChecks = ViewBag.CourtType == "Day" ? 4 : 3;
                     int checkedCount = 0;
                     if (ViewBag.CourtType == "Day")
                     {
                         if (Model[i].Court1Disposed) checkedCount++;
                         if (Model[i].Court1Warrant) checkedCount++;
                         if (Model[i].Court2Disposed) checkedCount++;
                         if (Model[i].Court2Warrant) checkedCount++;
                     }
                     else
                     {
                         if (Model[i].Court1Night) checkedCount++;
                         if (Model[i].Court2Night) checkedCount++;
                         if (Model[i].Court3Night) checkedCount++;
                     }
                     var progress = (int)Math.Round((checkedCount / (double)totalChecks) * 100);
                 }
                 <div class="progress" style="height: 20px;">
                     <div class="progress-bar bg-primary"
                          role="progressbar"
                          style="width: @progress%"
                          aria-valuenow="@progress"
                          aria-valuemin="0"
                          aria-valuemax="100">
                         @progress%
                     </div>
                 </div>
             </td>

             <td class="status-text">
                 @if (progress == 100)
                 {
                     <span class="text-success fw-bold">Completed</span>
                 }
                 else if (progress > 0)
                 {
                     <span class="text-warning fw-semibold">In Progress</span>
                 }
             </td>
         </tr>
     }
 </tbody>




    </table>

    <div class="d-flex justify-content-end mt-3">
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
    <div class="d-flex justify-content-end mt-3">
        <button type="button" class="btn btn-secondary" onclick="location.reload();">Cancel</button>
    </div>
</form>
