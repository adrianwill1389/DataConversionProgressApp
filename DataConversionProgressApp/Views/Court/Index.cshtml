@model List<DataConversionProgressApp.Models.CourtProgress>

<form method="post" asp-action="Save">
    <table class="table table-bordered table-dark">
        <thead>
            <tr>
                <th>Date</th>
                <th>Court 1 Disposed</th>
                <th>Court 1 Warrant</th>
                <th>Court 2 CaseManagement</th>
                <th>Court 2 Warrant</th>
                <th>Progress</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Count; i++)
            {
                <tr>
                    <td>
                        @Model[i].DateReceived.ToString("dddd, MMM d, yyyy")
                        <input type="hidden" asp-for="@Model[i].DateReceived" />
                    </td>
                    <td><input asp-for="@Model[i].Court1Disposed" type="checkbox" /></td>
                    <td><input asp-for="@Model[i].Court1Warrant" type="checkbox" /></td>
                    <td><input asp-for="@Model[i].Court2Disposed" type="checkbox" /></td>
                    <td><input asp-for="@Model[i].Court2Warrant" type="checkbox" /></td>

                    <!-- Progress Bar Column -->
                    <td>
                        <div class="progress" style="height: 20px; display: none;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 0%;" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                    </td>

                    <!-- Status Column -->
                    <td class="status-text"></td>
                </tr>

            }
        </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Save</button>
</form>

<!-- jQuery should already be in _Layout.cshtml -->
<script>
    function updateProgress(row) {
        const checkboxes = row.querySelectorAll("input[type='checkbox']");
        let checked = 0;

        checkboxes.forEach(cb => {
            if (cb.checked) checked++;
        });

        const progress = checked * 25;
        const progressWrap = row.querySelector(".progress");
        const progressBar = row.querySelector(".progress-bar");
        const status = row.querySelector(".status-text");

        if (progressWrap && progressBar) {
            if (progress > 0) {
                progressWrap.style.display = "block";
                progressBar.style.width = progress + "%";
                progressBar.textContent = progress + "%";
            } else {
                progressWrap.style.display = "none";
            }
        }

        if (status) {
            if (progress === 100) status.textContent = "Completed";
            else if (progress === 0) status.textContent = "";
            else status.textContent = "In Progress";
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("input[type='checkbox']").forEach(cb => {
            cb.addEventListener("change", function () {
                const row = this.closest("tr");
                updateProgress(row);
            });
        });

        document.querySelectorAll("tbody tr").forEach(row => {
            updateProgress(row); // initialize on page load
        });
    });
</script>
