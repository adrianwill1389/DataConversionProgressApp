@model List<DataConversionProgressApp.Models.CourtProgress>

<style>
    select.form-control {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: white;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='8'%3e%3cpolygon%20fill='%23666'%20points='0,0%207,8%2014,0'%3e%3c/polygon%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 12px;
        padding-right: 30px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

        /* Optional tweak for dark themes */
        select.form-control:focus {
            outline: none;
            border-color: #66afe9;
            box-shadow: 0 0 5px rgba(102,175,233,.6);
        }
</style>

<form method="get" asp-action="Index" id="dateForm">
    <div class="form-group text-center mb-4">
        <h4 class="text-info">Select Dates</h4>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label text-white">Select Month:</label>
        <div class="col-sm-4">
            <select name="month" class="form-control" onchange="document.getElementById('dateForm').submit();">
                @for (int m = 1; m <= 12; m++)
                {
                    var monthName = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(m);
                    if (m == ViewBag.SelectedMonth)
                    {
                        <option value="@m" selected>@monthName</option>
                    }
                    else
                    {
                        <option value="@m">@monthName</option>
                    }
                }
            </select>
        </div>

        <label class="col-sm-2 col-form-label text-white">Year:</label>
        <div class="col-sm-4">
            <input name="year" type="number" class="form-control"
                   value="@ViewBag.SelectedYear" onchange="document.getElementById('dateForm').submit();" />
        </div>
    </div>
</form>

<form method="post" asp-action="Save">

    <table class="table table-bordered table-dark">
        <thead>
            <tr>
                <th>Date</th>
                <th>Court 1 Disposed</th>
                <th>Court 1 Warrant</th>
                <th>Court 2 CaseManagement</th>
                <th>Court 2 Warrant</th>
                <th>Progress</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Count; i++)
            {
                <tr>
                    <td>
                        @Model[i].DateReceived.ToString("dddd, MMM d, yyyy")
                        <input type="hidden" asp-for="@Model[i].DateReceived" />
                    </td>
                    <td><input asp-for="@Model[i].Court1Disposed" type="checkbox" /></td>
                    <td><input asp-for="@Model[i].Court1Warrant" type="checkbox" /></td>
                    <td><input asp-for="@Model[i].Court2Disposed" type="checkbox" /></td>
                    <td><input asp-for="@Model[i].Court2Warrant" type="checkbox" /></td>

                    <!-- Progress Bar Column -->
                    <td>
                        <div class="progress" style="height: 20px; display: none;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 0%;" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                    </td>

                    <!-- Status Column -->
                    <td class="status-text"></td>
                </tr>

            }
        </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Save</button>
</form>

<!-- jQuery should already be in _Layout.cshtml -->
<script>
    function updateProgress(row) {
        const checkboxes = row.querySelectorAll("input[type='checkbox']");
        let checked = 0;

        checkboxes.forEach(cb => {
            if (cb.checked) checked++;
        });

        const progress = checked * 25;
        const progressWrap = row.querySelector(".progress");
        const progressBar = row.querySelector(".progress-bar");
        const status = row.querySelector(".status-text");

        if (progressWrap && progressBar) {
            if (progress > 0) {
                progressWrap.style.display = "block";
                progressBar.style.width = progress + "%";
                progressBar.textContent = progress + "%";
            } else {
                progressWrap.style.display = "none";
            }
        }

        if (status) {
            if (progress === 100) status.textContent = "Completed";
            else if (progress === 0) status.textContent = "";
            else status.textContent = "In Progress";
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("input[type='checkbox']").forEach(cb => {
            cb.addEventListener("change", function () {
                const row = this.closest("tr");
                updateProgress(row);
            });
        });

        document.querySelectorAll("tbody tr").forEach(row => {
            updateProgress(row); // initialize on page load
        });
    });
</script>
