@model List<TickedItem>

<!-- Activity Log Section -->
<div class="section-box">
    <h2 class="text-primary">
        <i class="bi bi-journal-text"></i> Activity Log
    </h2>
    <hr class="my-4" />

    @if (!Model.Any())
    {
        <p>No ticked items found yet. Start tracking your progress!</p>
    }
    else
    {
        <table class="table table-sm table-bordered log-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Task</th>
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model
               .GroupBy(i => new { i.Date, Task = (i.TaskName ?? "").Replace(" (Removed)", "") })
               .Select(g => g.OrderByDescending(i => i.Timestamp).First())
               .Where(i => !((i.TaskName ?? "").Contains("(Removed)")))
               )
                {
                    <tr>
                        <td>@item.Date.ToString("MMM dd, yyyy")</td>
                        <td title="Ticked by @item.Username">@item.TaskName</td>
                        <td>@item.Timestamp.ToString("MMM dd, yyyy h:mm tt")</td>
                    </tr>
                }

            </tbody>
        </table>
    }
</div>

<!-- Undo History Section -->
@if (ViewBag.RemovedTicks != null && ((List<TickedItem>)ViewBag.RemovedTicks).Any())
{
    <div class="section-box">
        <h2 class="text-danger mt-2">
            <i class="bi bi-x-circle"></i> Undo History
        </h2>
        <hr class="my-2" />

        <table class="table table-sm table-bordered log-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Task</th>
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (List<TickedItem>)ViewBag.RemovedTicks)
                {
                    <tr>
                        <td>@item.Date.ToString("MMM dd, yyyy")</td>
                        <td title="Removed by @item.Username">@item.TaskName</td>
                        <td>@item.Timestamp.ToString("MMM dd, yyyy h:mm tt")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
